jobs:
  include:

    - &unit-test-stage
      stage: Unit Testing
      language: generic
      os: linux
      env: unit_test
      env: branch=beta
      before_install:
         - sudo apt-get install -y --no-install-recommends lib32stdc++6 libstdc++6 > /dev/null
      before_script:
        - git clone https://github.com/flutter/flutter.git -b $branch
        - export PATH="$PATH":"$HOME/.pub-cache/bin"
        - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
        - flutter precache
        - flutter doctor -v
        - pub global activate coverage
      script: ./scripts/runTests.sh
      after_success: bash <(curl -s https://codecov.io/bash) -f lcov.info
    - <<: *unit-test-stage
      os: osx
    - <<: *unit-test-stage
      env: branch=dev
    - <<: *unit-test-stage
      os: osx
      env: branch=dev

  allow_failures:
    - env: branch=dev